<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="subtitle" content="&quot;GEOSTAT 2016&quot;">
<meta name="category" content="intermediate">
<meta name="length" content="3h">
<meta name="layout" content="page">
<meta name="date" content="2016-09-21">
<meta name="author" content="'Jorge Sanz'"><style>body {
  width: 45em;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 30px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headeranchor-link {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  display: block;
  padding-right: 6px;
  padding-left: 30px;
  margin-left: -30px;
}

.markdown-body .headeranchor-link:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .headeranchor,
.markdown-body h2 .headeranchor,
.markdown-body h3 .headeranchor,
.markdown-body h4 .headeranchor,
.markdown-body h5 .headeranchor,
.markdown-body h6 .headeranchor {
  display: none;
  color: #000;
  vertical-align: middle;
}

.markdown-body h1:hover .headeranchor-link,
.markdown-body h2:hover .headeranchor-link,
.markdown-body h3:hover .headeranchor-link,
.markdown-body h4:hover .headeranchor-link,
.markdown-body h5:hover .headeranchor-link,
.markdown-body h6:hover .headeranchor-link {
  height: 1em;
  padding-left: 8px;
  margin-left: -30px;
  line-height: 1;
  text-decoration: none;
}

.markdown-body h1:hover .headeranchor-link .headeranchor,
.markdown-body h2:hover .headeranchor-link .headeranchor,
.markdown-body h3:hover .headeranchor-link .headeranchor,
.markdown-body h4:hover .headeranchor-link .headeranchor,
.markdown-body h5:hover .headeranchor-link .headeranchor,
.markdown-body h6:hover .headeranchor-link .headeranchor {
  display: inline-block;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* Multimarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px octicons-anchor;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\f05c';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><title>GEOSTAT CARTO Tutorial</title></head><body><article class="markdown-body"><hr />
<ul>
<li>Trainer: Jorge Sanz · <a href="mailto:jorge@carto.com">jorge@carto.com</a> · <a href="http://twitter.com/xurxosanz">@xurxosanz</a></li>
<li>September 21st, 2016</li>
<li>CARTO Tutorial about the Builder and Engine</li>
<li><a href="http://bit.ly/160921-geostat-carto"><a href="http://bit.ly/160921-geostat-carto"><a href="http://bit.ly/160921-geostat-carto">http://bit.ly/160921-geostat-carto</a></a></a></li>
</ul>
<h2 id="introduction"><a name="user-content-introduction" href="#introduction" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Introduction</h2>
<h3 id="prerequisites"><a name="user-content-prerequisites" href="#prerequisites" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Prerequisites</h3>
<ul>
<li>A modern browser (Google Chrome would be perfect)</li>
<li><a href="http://getpostman.com">Postman</a> if you want to play with CARTO APIs, but you can use <code>curl</code> or any other decent HTTP client (desirable)</li>
<li>A HTML/JavaScript capable text editor like Notepad++, gedit, sublime text, atom, etc (optional)</li>
</ul>
<h3 id="map-academy-tutorials-and-other-online-resources"><a name="user-content-map-academy-tutorials-and-other-online-resources" href="#map-academy-tutorials-and-other-online-resources" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Map Academy, tutorials and other online resources</h3>
<p>You can take a look on those resources if you want to warm up with CARTO</p>
<ul>
<li><a href="http://carto.com/academy"><strong>Map Academy</strong> courses</a>.</li>
<li><a href="https://carto.com/docs/tutorials/"><strong>Tutorials</strong></a>.</li>
<li><a href="https://github.com/ramiroaznar/intro-cartodb">Other online resources</a>.</li>
</ul>
<h3 id="further-questions-and-troubleshooting"><a name="user-content-further-questions-and-troubleshooting" href="#further-questions-and-troubleshooting" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Further questions and troubleshooting</h3>
<ul>
<li>Email to <strong><a href="mailto:support@cartodb.com"><a href="mailto:support@cartodb.com">support@cartodb.com</a></a></strong>.</li>
<li>Some questions could be already anwered at <strong><a href="http://gis.stackexchange.com/questions/tagged/cartodb">GIS Stack Exchange</a></strong> <code>carto</code> tag.</li>
</ul>
<h3 id="contents"><a name="user-content-contents" href="#contents" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Contents</h3>
<ul>
<li><a href="#intro">Introduction to CARTO</a></li>
<li><a href="#builder">Builder</a></li>
<li><a href="#sf-trees">San Francisco trees</a></li>
<li><a href="#portland">Portland sales territories</a></li>
<li><a href="#railways">USA railways risk analysis</a></li>
<li><a href="#engine">Engine overview</a></li>
<li><a href="#postgis">Spatial SQL</a></li>
<li><a href="#apis">APIs</a></li>
<li><a href="#cartojs">CARTO.js</a></li>
</ul>
<h3 id="accounts-set-up"><a name="user-content-accounts-set-up" href="#accounts-set-up" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Accounts set up</h3>
<ul>
<li>The instructor will provide you a user and passwor to access your account</li>
<li>Log into your <code>geostatXX</code> account going to <code>https://geostatXX.carto.com</code></li>
</ul>
<hr />
<h2 id="introduction-to-carto"><a name="user-content-introduction-to-carto" href="#introduction-to-carto" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Introduction to CARTO <a name="intro"></a></h2>
<p>Slides available <a href="https://docs.google.com/presentation/d/1hZ1ddeS2UdShQNVSYb6tRl4IdQTya496xRA2N2wqygI/pub?start=false&amp;loop=false&amp;delayms=3000">here</a></p>
<p><img alt="" src="/home/jsanz/src/cartodb/training/img/160921-geostat/slides.png" /></p>
<h2 id="builder"><a name="user-content-builder" href="#builder" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Builder <a name="builder"></a></h2>
<p>The Builder is the new main web interface to interact with the CARTO platform. It&rsquo;s a product aimed to everyone willing to manage, analyze and visualize geospatial information. It&rsquo;s highly focused on usability, with a friendly graphical interface that unlocks all the power of the CARTO Engine without having to know all the details on underlying technologies such as PostGIS or CartoCSS.</p>
<h3 id="simple-exercise-san-francisco-tree-map"><a name="user-content-simple-exercise-san-francisco-tree-map" href="#simple-exercise-san-francisco-tree-map" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Simple exercise: San Francisco tree map <a name="sf-trees"></a></h3>
<ul>
<li><em>Degree of Difficulty</em>: **</li>
<li><em>Goal</em>: Display the different kinds of trees in San Francisco and when they were planted.</li>
<li><em>Features Highlighted</em>:</li>
<li>Widgets: Category and time-series widget.</li>
<li><em>Datasests needed</em>:</li>
<li>sf_trees dataset from the <a href="https://team.carto.com/u/builder-demo/viz/10be49bc-6683-466e-8cbe-c11d4ef4aa95/public_map">San Francisco Trees map</a></li>
</ul>
<h4 id="1-import-and-create-map"><a name="user-content-1-import-and-create-map" href="#1-import-and-create-map" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1. Import and create map</h4>
<h5 id="1-1-import-the-street-tree-list-as-a-csv-file-into-your-dataset-dashboard"><a name="user-content-1-1-import-the-street-tree-list-as-a-csv-file-into-your-dataset-dashboard" href="#1-1-import-the-street-tree-list-as-a-csv-file-into-your-dataset-dashboard" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1. 1. Import the <code>Street Tree List</code> as a csv file into your dataset dashboard.</h5>
<ul>
<li>Download the dataset as a CSV</li>
<li>Go to your account and import is using the <code>NEW DATASET</code> wizard</li>
</ul>
<h5 id="1-2-dataset-view"><a name="user-content-1-2-dataset-view" href="#1-2-dataset-view" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1. 2. Dataset view</h5>
<ul>
<li>Take a look on the dataset</li>
<li>Switch between the metadata and the SQL view, try any simple query like limiting the result.</li>
<li>Take a look on the spatial distribution using the <code>PREVIEW</code> window.</li>
</ul>
<h4 id="1-3-click-on-create-map-from-the-street-tree-list-dataset"><a name="user-content-1-3-click-on-create-map-from-the-street-tree-list-dataset" href="#1-3-click-on-create-map-from-the-street-tree-list-dataset" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1. 3. Click on <code>CREATE MAP</code> from the <code>Street Tree List</code> dataset.</h4>
<ul>
<li>Change the name of the map to <code>San Francisco Trees</code></li>
</ul>
<blockquote>
<p><strong>Warning</strong>: after renaming a layer a error could pop up saying &ldquo;the map cannot be rendered&rdquo;, don&rsquo;t worry about this. Refresh the page and it will dissapear.</p>
</blockquote>
<h4 id="2-layers-and-styles"><a name="user-content-2-layers-and-styles" href="#2-layers-and-styles" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2. Layers and styles</h4>
<h5 id="2-1-ordering-of-the-layers-in-the-builder"><a name="user-content-2-1-ordering-of-the-layers-in-the-builder" href="#2-1-ordering-of-the-layers-in-the-builder" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2. 1. Ordering of the layers in the Builder</h5>
<ul>
<li>
<p>Change the basemap to the dark_matter (labels below) basemap and check the different basemaps options.</p>
</li>
<li>
<p>Note how the layer we added gets the <code>a0</code> identifier. This is not important now but it will be later when adding analysis and widgets.</p>
</li>
</ul>
<h5 id="2-2-layer-options"><a name="user-content-2-2-layer-options" href="#2-2-layer-options" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2. 2. Layer options</h5>
<ul>
<li><code>DATA</code>:</li>
<li>This interface gives a general view of the fields the layer, its name and its data type but also from there you can add them as widgets.</li>
<li>Switch to <code>VALUES</code> to <code>SQL</code>. The SQL panel allows more advanced users to manage data in a more precise way.</li>
<li>
<p>Finally, use the button in the bottom center of the map to switch between the table and the map view.</p>
</li>
<li>
<p><code>STYLE</code>:</p>
</li>
<li>In the <code>Aggregation menu</code>, select the <code>None</code> option.</li>
<li>In the <code>Fill</code> options, select the <code>By Value</code> option and then choose the <code>common_species</code> option to color the dots depending on the values of the <code>common_species</code> values.</li>
<li>Change the size of the dots to 3 and change the stroke value of the points to 0.</li>
</ul>
<p><img alt="style" src="https://cloud.githubusercontent.com/assets/11177693/17486997/4718a482-5d93-11e6-838f-0865c1b57385.png" /></p>
<ul>
<li><code>POP-UPS</code>:</li>
<li>Select the Hover tab and the light style for the hover infowindow.</li>
<li>In the <code>Show Items</code> section of the hover menu, select the <code>common_species</code> field and change its name to <em>Common Species</em>.</li>
<li>By doing this, a pop-up will appear when we hover over the points on the map.</li>
</ul>
<p><img alt="hover" src="https://cloud.githubusercontent.com/assets/11177693/17486993/420e9e24-5d93-11e6-8a94-7b9dd9b90aa2.png" /></p>
<h4 id="3-widgets"><a name="user-content-3-widgets" href="#3-widgets" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. Widgets</h4>
<h5 id="3-1-category-widget"><a name="user-content-3-1-category-widget" href="#3-1-category-widget" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. 1. Category Widget</h5>
<ul>
<li>Back to the main menu, select the <code>WIDGETS</code> tab and select the <code>ADD WIDGET</code>.</li>
<li>In the options of the <code>Category</code> tab, select the <code>common_species</code> and <code>caretaker</code> checkboxes in order to have widgets that display the different categories of the <code>common_species</code> and <code>caretaker</code> fields. Click <code>CONTINUE</code>to add the widgets on the map.</li>
</ul>
<p><img alt="category" src="https://cloud.githubusercontent.com/assets/11177693/17486990/3d021a32-5d93-11e6-9ad0-7bae2f8d787a.png" /></p>
<h5 id="3-2-time-series-widget"><a name="user-content-3-2-time-series-widget" href="#3-2-time-series-widget" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. 2. Time series widget</h5>
<ul>
<li>Back to the main menu, select the <code>WIDGETS</code> tab and select the <code>ADD WIDGET</code>.</li>
<li>In the options of the <code>Time-series</code> tab, select the <code>plant_date</code> checkbox in order to display the dates were the trees were planted. Click <code>CONTINUE</code>to add the widgets on the map.</li>
</ul>
<p><img alt="time" src="https://cloud.githubusercontent.com/assets/11177693/17486985/385eb94a-5d93-11e6-8b00-6ab790c97d5f.png" /></p>
<h5 id="3-3-change-order-and-name-of-widgets"><a name="user-content-3-3-change-order-and-name-of-widgets" href="#3-3-change-order-and-name-of-widgets" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. 3. Change order and name of widgets</h5>
<ul>
<li>Back to the main menu, select the <code>WIDGETS</code> tab to see a list with the widgets that we have added.</li>
<li>We can drag and drop the widgets in the widget menu to change their order.</li>
</ul>
<p><img alt="widgets" src="https://cloud.githubusercontent.com/assets/11177693/17486975/33b7c92c-5d93-11e6-8037-c25cc3272bc0.png" /></p>
<ul>
<li>We can change the name of our widgets by selecting the <code>rename</code> option of the widget menu or by doing a double click on the widget name in the widgets menu.</li>
</ul>
<p><img alt="rename" src="https://cloud.githubusercontent.com/assets/11177693/17486968/2f02e06a-5d93-11e6-931c-e8e237a1969e.png" /></p>
<ul>
<li>Change the name of the <code>common_species</code> widget to <code>Common Species</code>, the name of the <code>caretaker</code> widget to <code>Caretaker</code> and the name of the <code>plant_date</code> widget to <code>Plant Date</code>.</li>
</ul>
<p><img alt="names_changed" src="https://cloud.githubusercontent.com/assets/11177693/17486963/2ad66318-5d93-11e6-824b-f6ad8e1875a8.png" /></p>
<h4 id="4-share-map"><a name="user-content-4-share-map" href="#4-share-map" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4. Share map</h4>
<ul>
<li>At the bottom of the main menu, click the <code>Share</code> button.</li>
<li>Select the <code>Publish</code> tab and click on the <code>Publish</code> button that is below the Map title in order to share our map.</li>
</ul>
<p><img alt="publish" src="https://cloud.githubusercontent.com/assets/11177693/17486954/2471f492-5d93-11e6-8ca9-6be7d27d0a2c.png" /></p>
<ul>
<li>After clicking the <code>Publish</code> button, we can select the option that we want to share our map.</li>
</ul>
<p><img alt="share" src="https://cloud.githubusercontent.com/assets/11177693/17486948/1d60b120-5d93-11e6-9d74-af8ca56667c9.png" /></p>
<h3 id="analysis-exercise-sales-territories"><a name="user-content-analysis-exercise-sales-territories" href="#analysis-exercise-sales-territories" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Analysis exercise: sales territories <a name="portland"></a></h3>
<ul>
<li><em>Degree of Difficulty</em>: ***.</li>
<li><em>Goal</em>: Find the best place to create a store near the customers.</li>
<li><em>Features Highlighted</em>:</li>
<li>Analysis: Cluster Analysis, Weight Centroid Analysis, Area of influence analysis and Filter Points in polygons analysis.</li>
<li>Widgets: Formula widget and histogram widget.</li>
<li><em>Datasests needed</em>:</li>
<li>Customer locations dataset <strong><code>customer_home_locations</code></strong> from <a href="https://team.carto.com/u/builder-demo/viz/39fd43f3-3d3b-4b71-8c13-895305ccc2b8/public_map">Sales Territories (Portland) Demo</a>.</li>
</ul>
<h4 id="1-import-and-create-map_1"><a name="user-content-1-import-and-create-map_1" href="#1-import-and-create-map_1" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1. Import and create map</h4>
<h5 id="1-1-import-customer_home_locations-csv"><a name="user-content-1-1-import-customer_home_locations-csv" href="#1-1-import-customer_home_locations-csv" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1. 1. Import <code>customer_home_locations</code> csv.</h5>
<ul>
<li>Use the <code>NEW DATASET</code> wizard to import the table.</li>
</ul>
<h5 id="1-2-click-on-create-map-from-the-customer_home_locations"><a name="user-content-1-2-click-on-create-map-from-the-customer_home_locations" href="#1-2-click-on-create-map-from-the-customer_home_locations" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1. 2. Click on <code>CREATE MAP</code> from the <code>customer_home_locations</code>.</h5>
<h5 id="1-3-rename-customer_home_locations-to-customer-home-locations-and-change-the-title-of-the-map-to-sales-territories-portland-demo"><a name="user-content-1-3-rename-customer_home_locations-to-customer-home-locations-and-change-the-title-of-the-map-to-sales-territories-portland-demo" href="#1-3-rename-customer_home_locations-to-customer-home-locations-and-change-the-title-of-the-map-to-sales-territories-portland-demo" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1. 3. Rename <code>customer_home_locations</code> to <code>Customer home locations</code> and change the title of the map to <code>Sales Territories (Portland) Demo</code>.</h5>
<blockquote>
<p><strong>Warning</strong>: after renaming a layer a error could pop up saying &ldquo;the map cannot be rendered&rdquo;, don&rsquo;t worry about this. Refresh the page and it will dissapear.</p>
</blockquote>
<ul>
<li>You should have a dashboard like this:</li>
</ul>
<p><img alt="first" src="https://cloud.githubusercontent.com/assets/11177693/17555923/ba604862-5f11-11e6-9d23-1a077768664d.png" /></p>
<h4 id="2-layer-styling-first-view"><a name="user-content-2-layer-styling-first-view" href="#2-layer-styling-first-view" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2. Layer styling: first view</h4>
<p>On this example we will start with a single color styling and fixed marker size.</p>
<ul>
<li>Change the fill color to <code>#cc1035</code> and set the size of the markers to 7.</li>
<li>Set the stroke of the points to 0.</li>
<li>Switch to <code>VALUES</code> to <code>CARTOCSS</code>. Take a look on the CartoCSS properties and try to change any of them like increasing the width of the marker.</li>
</ul>
<p><img alt="style" src="https://cloud.githubusercontent.com/assets/11177693/17555973/eb10414c-5f11-11e6-93f9-0ecec4734b50.png" /></p>
<h4 id="3-analysis"><a name="user-content-3-analysis" href="#3-analysis" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. Analysis</h4>
<h5 id="3-1-cluster-analysis"><a name="user-content-3-1-cluster-analysis" href="#3-1-cluster-analysis" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. 1. Cluster Analysis</h5>
<ul>
<li>
<p>Back to the main menu of the layers, select the <code>customer_home_locations</code> layer and click on <code>ADD ANALYSIS</code> option.</p>
</li>
<li>
<p>From the analysis menu, select the <code>Calculate cluster points</code> analysis and click on <code>ADD ANALYSIS</code>.</p>
</li>
</ul>
<p><img alt="cluster" src="https://cloud.githubusercontent.com/assets/11177693/17555994/fb2fceb2-5f11-11e6-8581-fac500980730.png" /></p>
<ul>
<li>In the <code>ANALYSES</code> tab of the layer, we have three sections:</li>
<li><strong>Workflow</strong>: Is an overview of the analysis that we apply to the layer, so you can have more than one. The analysis should have the name <code>A1</code> to indicate that is the first analysis applied to the layer.</li>
<li><strong>Source</strong>: asks for the geometry where we will calculate the cluster of the <code>customer_home_locations</code> layer.</li>
<li><strong>Parameters</strong>: Define the number of possible stores that you want. We set the number of clusters to 6.</li>
</ul>
<p><img alt="cluster_param" src="https://cloud.githubusercontent.com/assets/11177693/17556057/458239c8-5f12-11e6-90f4-5fb95316bab3.png" /></p>
<ul>
<li>After clicking <code>Apply</code>, CARTO will return the result of the <code>Calculate cluster points</code> analysis. After finishing the analysis, CARTO will return the same number of points on the map, but with an extra column called <code>cluster_no</code>.</li>
<li>In order to have a better understanding of the result of the <code>Calculate cluster points</code> analysis and see how the points are grouped, we should change the fill option of the points (in the <code>Style</code> tab) according to the value of the <code>cluster_no</code> column using the <code>BY VALUE</code> option:</li>
</ul>
<p><img alt="style_cluster" src="https://cloud.githubusercontent.com/assets/11177693/17556078/61faae5a-5f12-11e6-8a64-3c16236b48f2.png" /></p>
<h5 id="3-2-weight-centroid-analysis"><a name="user-content-3-2-weight-centroid-analysis" href="#3-2-weight-centroid-analysis" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. 2. Weight Centroid Analysis</h5>
<ul>
<li>We will apply the analysis to the  result of the <code>Calculate cluster points</code>  analysis, so we will go back to the main menu and we will  click on the <code>ADD ANALYSIS</code> option of the <code>customer_home_locations</code> layer.</li>
<li>We will select the <code>Find centroid of geometries</code> analysis.</li>
</ul>
<p><img alt="centroid" src="https://cloud.githubusercontent.com/assets/11177693/17556117/884168f6-5f12-11e6-8313-45c8a0ff577e.png" /></p>
<ul>
<li>In the <code>ANALYSES</code> tab of the layer, we have two sections:</li>
<li><strong>Workflow</strong>: Now, because we are applying a second analysis to the <code>customer_home_locations</code> layer, the workflow has changed. <code>A1</code> represent the cluster analysis, but now we have a new analysis named <code>A2</code> to indicate that is the second analysis applied to the layer.</li>
<li><strong>Centroid</strong>:<ul>
<li><em>Source</em>: we indicate that we are using as the source, the results from the <code>Calculate cluster points</code>  analysis. The source is not the original points of the layer, but the points that we got after the <code>Calculate cluster points</code>  analysis.</li>
</ul>
</li>
<li><strong>Parameters</strong>: to set how we want to calculate the centroids of the cluster data. We will select the  <code>Categorized by</code> option using the <code>cluster_no</code> column, we will also select the <code>Aggregated by</code> parameter to aggregate  the result using the average  of the <code>customer_value</code> column and finally we will select the <code>Weigthted by</code> parameter using the <code>customer_value</code> column to indicate the column that we want to use to calculate the centroids of the clustered regions.</li>
</ul>
<p><img alt="centroid_param" src="https://cloud.githubusercontent.com/assets/11177693/17556178/c24bbc4a-5f12-11e6-866d-b70784abdc05.png" /></p>
<ul>
<li>After clicking <code>Apply</code>, we should see a result where we can see the centroids of the clustered areas from the Cluster Analysis</li>
</ul>
<p><img alt="centroid_result" src="https://cloud.githubusercontent.com/assets/11177693/17556251/055b6242-5f13-11e6-80e7-06ff2eee4e19.png" /></p>
<h6 id="3-2-1-improve-visualization"><a name="user-content-3-2-1-improve-visualization" href="#3-2-1-improve-visualization" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. 2. 1. Improve visualization</h6>
<ul>
<li>We could style our resulting points by changing the size and the color according to the resulting aggregated values.</li>
</ul>
<p><img alt="centroid_styled" src="https://cloud.githubusercontent.com/assets/11177693/17556256/0fd68f80-5f13-11e6-835d-e3c62657aafb.png" /></p>
<ul>
<li>We also could add a popup to the layer, so for each point we can display its value. In order to do this we go to the <code>Popup</code> tab and we select the <code>hover</code> option to display the popup when we mouse over the centroids.<br />
We select the column <code>value</code> to display its values in the popup.  We also will change the name that will be displayed on the popup to <code>AVG. CUSTOMER VALUE</code>.</li>
</ul>
<p><img alt="popup" src="https://cloud.githubusercontent.com/assets/11177693/17556317/3b40755a-5f13-11e6-9623-4b4e4bdf4e20.png" /></p>
<ul>
<li>Back to the main menu, in the <code>Layers</code> tab,we drag and drop the Cluster node analysis outside of the layer (layer A1) to create a new data layer with the customer locations (layer B).By doing this, we will have on the map a layer with the clustered points and a layer with their centroids.</li>
</ul>
<p><img alt="drag_drop" src="https://cloud.githubusercontent.com/assets/11177693/17556368/741d3f2a-5f13-11e6-8575-67f47006b9d0.png" /></p>
<ul>
<li>Now, we change the name of the layers. The name of Layer A will be <code>Centroids</code> and the name of layer B will be <code>Customer Locations</code>. Then, we change the style of the <code>Customer Locations</code> layer using the values from the column <code>cluster_no</code> in order to style the points depending on the cluster they belong to.</li>
</ul>
<p><img alt="style_2" src="https://cloud.githubusercontent.com/assets/11177693/17556407/9adcc5f4-5f13-11e6-9a39-4368cb65b2d7.png" /></p>
<h5 id="3-3-area-of-influence-analysis"><a name="user-content-3-3-area-of-influence-analysis" href="#3-3-area-of-influence-analysis" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. 3. Area of influence analysis</h5>
<ul>
<li>We will apply the analysis to the  result of the Centroid Analysis.We will go back to the main menu and we will  click on the <code>ADD ANALYSIS</code> option of the <code>Centroids</code> layer (A).</li>
<li>We will select the <code>Create areas of influence</code> analysis.</li>
</ul>
<p><img alt="aoi" src="https://cloud.githubusercontent.com/assets/11177693/17556443/b2f22f80-5f13-11e6-8aa4-22cb8bbb0f9f.png" /></p>
<ul>
<li>In the <code>ANALYSES</code> tab of the layer, we have three sections:</li>
<li><strong>Workflow</strong>: Now, because we are applying a third analysis to the <code>Centroids</code> layer, the workflow has changed. <code>A1</code> represent the cluster analysis, <code>A2</code> represent the Centroid analysis and <code>A3</code> indicates the third analysis applied to the layer.</li>
<li><strong>Create areas of influence</strong>:<ul>
<li><em>Input</em>: we indicate that we are using as the input, the results from the <code>Centroid</code> analysis. The input is not the original points of the layer, but the points that we got after the <code>Centroid</code> analysis.</li>
</ul>
</li>
<li><strong>Parameters</strong>: define the distance of the area of influence, the type of units, the radius and the boundaries. The boundaries might be <code>intact</code> or <code>dissolved</code>. If we choose the <code>intact</code> option, that means that if our areas of influence polygons overlap, then they will keep their original polygon borders. On the other hand, if we choose the <code>dissolve</code> option, if the areas of influence polygons overlap, they will be merged so the result will be one big polygon. We set the units to kilometres, set the radius to <code>1</code> kilometre and choose the <code>intact</code> option for the <code>boundaries</code> parameter.</li>
<li>After clicking <code>Apply</code>, we should see a result where we can see the areas of influence of 100 meters around the subway stations:</li>
</ul>
<p><img alt="aoi_result" src="https://cloud.githubusercontent.com/assets/11177693/17556494/e1f8aa52-5f13-11e6-81f4-6b92ef10ecf0.png" /></p>
<h6 id="3-3-1-improve-visualization"><a name="user-content-3-3-1-improve-visualization" href="#3-3-1-improve-visualization" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. 3. 1. Improve visualization</h6>
<ul>
<li>Back to the main menu, in the <code>Layers</code>tab,we drag and drop the Area of influence node analysis outside of layer (A3) to create a new Data layer with the areas of influence (C). The new layer (C) will have the same name as the layer A, we will change the name of layer C to <code>Areas of Influence</code>.</li>
</ul>
<p><img alt="areas" src="https://cloud.githubusercontent.com/assets/11177693/17556500/e7eb561c-5f13-11e6-868e-01537f6e5235.png" /></p>
<h5 id="3-4-filter-points-in-polygons-analysis"><a name="user-content-3-4-filter-points-in-polygons-analysis" href="#3-4-filter-points-in-polygons-analysis" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. 4. Filter Points in polygons analysis</h5>
<ul>
<li>We will apply the analysis to the <code>Areas of Influence</code> layer, so we click <code>ADD ANALYSIS</code> option of that layer and we select the <code>Filter points in polygons</code> option.</li>
</ul>
<p><img alt="fpp_options" src="https://cloud.githubusercontent.com/assets/11177693/17556507/efa15b54-5f13-11e6-9fe7-e5d2be9d3524.png" /></p>
<ul>
<li>In the <code>ANALYSES</code> tab of the layer, we have two sections:</li>
<li><strong>Workflow</strong>: Now, because we are applying a second analysis to the <code>Areas of Influence</code> layer, the workflow has changed. <code>B1</code> represent the area of influence analysis, but now we have a new analysis named <code>B2</code> to indicate that is the second analysis applied to the layer.</li>
<li>
<p><strong>Filter points in polygons</strong>:</p>
<ul>
<li><em>Source</em>: we indicate that we are using as the source, the results from the <code>area of influence</code> analysis. The source is not the original points of the layer, but the polygons that we got after the <code>area of influence</code> analysis.</li>
<li><strong>Target Layer</strong>: is the <code>Clusters</code> layer (B1).</li>
</ul>
</li>
<li>
<p>After clicking <code>Apply</code>, we should see a result where instead of the circles we had before on our <code>Areas of Influence</code> Layer, we should have now points referring to customers within those <code>Areas of Influence</code>. The result is indicating the customers that are closer to the stores.</p>
</li>
</ul>
<p><img alt="fpp_result" src="https://cloud.githubusercontent.com/assets/11177693/17556514/f7857e40-5f13-11e6-94f3-bfcee82ba403.png" /></p>
<h4 id="4-widgets"><a name="user-content-4-widgets" href="#4-widgets" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4. Widgets</h4>
<h5 id="4-1-formula-widget"><a name="user-content-4-1-formula-widget" href="#4-1-formula-widget" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4. 1. Formula widget</h5>
<ul>
<li>Back to the main menu, select the WIDGETS tab and select the ADD WIDGET option.</li>
<li>In the options of the Formula tab, select the <code>cartodb_id</code>column of the B1 layer and we click on <code>CONTINUE</code>.</li>
</ul>
<p><img alt="wid1_option" src="https://cloud.githubusercontent.com/assets/11177693/17556528/0a042c10-5f14-11e6-9ab3-d5642cf9691c.png" /></p>
<ul>
<li>In the widget menu, we set the <code>OPERATION</code> parameter to <code>count</code> and we change the name of the widget to <code>Total Customers</code>.</li>
</ul>
<p><img alt="wid1_result" src="https://cloud.githubusercontent.com/assets/11177693/17556546/125cf658-5f14-11e6-97d5-8ad54bdea71f.png" /></p>
<ul>
<li>Back to the main menu, select the WIDGETS tab and select the ADD WIDGET option.</li>
<li>In the options of the Formula tab, select the <code>cartodb_id</code>  of the C2 layer.</li>
</ul>
<p><img alt="wid2_option" src="https://cloud.githubusercontent.com/assets/11177693/17556554/18acc538-5f14-11e6-91ca-01b225c5544d.png" /></p>
<ul>
<li>In the widget menu, we set the <code>OPERATION</code> parameter to <code>count</code> and we change the name of the widget to <code>Customers within Areas of influence</code>.</li>
</ul>
<p><img alt="wid2_result" src="https://cloud.githubusercontent.com/assets/11177693/17556559/1d41cb20-5f14-11e6-8b1c-c33cae71212a.png" /></p>
<h5 id="4-2-histogram-widget"><a name="user-content-4-2-histogram-widget" href="#4-2-histogram-widget" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4. 2. Histogram widget</h5>
<ul>
<li>Back to the main menu, select the WIDGETS tab and select the ADD WIDGET option.</li>
<li>In the options of the Histogram tab, select the <code>customer_value</code> of the B1 layer and we click on <code>CONTINUE</code>.</li>
</ul>
<p><img alt="wid3_option" src="https://cloud.githubusercontent.com/assets/11177693/17556566/223d6fbc-5f14-11e6-8ddb-22ba492944a2.png" /></p>
<ul>
<li>We should get a &ldquo;U shape&rdquo; histogram:</li>
</ul>
<p><img alt="wid3_result" src="https://cloud.githubusercontent.com/assets/11177693/17556569/26ed2250-5f14-11e6-9189-70cbdc850b9c.png" /></p>
<ul>
<li>Go back to the main menu, and filter your map with the histogram. Watch how the map changes !</li>
</ul>
<p><img alt="filter" src="https://cloud.githubusercontent.com/assets/11177693/17556577/2ba34450-5f14-11e6-9f99-8245ccb065e6.png" /></p>
<h3 id="analysis-exercise-railways-risk-analysis"><a name="user-content-analysis-exercise-railways-risk-analysis" href="#analysis-exercise-railways-risk-analysis" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Analysis exercise: railways risk analysis<a name="railways"></a></h3>
<ul>
<li><em>Degree of Difficulty</em>: ***</li>
<li><em>Goal</em>: what US counties have higher risk for insuring railroad companies.</li>
<li><em>Features Highlighted</em>:</li>
<li>Widgets: Category, Formula and Time Series.</li>
<li>Analysis: Intersect, Outliers &amp; Cluster analysis.</li>
<li><em>Datasests needed</em>:</li>
<li>Railroad accidents (<strong><code>dot_rail_safety_data</code></strong>): download it <a href="https://team.carto.com/u/ramirocartodb/tables/builder-demo.dot_rail_safety_data_1/public/map?redirected=true">from the <code>builder-demo</code> CARTO account</a> and import it into CARTO from your local machine.</li>
<li>US counties (<strong><code>cb_2013_us_county_500k</code></strong>): search and connect via Data Library.</li>
</ul>
<h4 id="1-import-and-create-a-map"><a name="user-content-1-import-and-create-a-map" href="#1-import-and-create-a-map" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1. Import and create a map</h4>
<ul>
<li>Import the <code>dot_rail_safety_data</code> csv file into your dataset dashboard.</li>
<li>Create a new map with it</li>
<li>You should have a dashboard like this:</li>
</ul>
<p><img alt="1" src="https://cloud.githubusercontent.com/assets/5215798/17328904/6ad50596-58c0-11e6-8410-b4495ff40a7a.png" /></p>
<h4 id="2-style-layer"><a name="user-content-2-style-layer" href="#2-style-layer" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2. Style layer</h4>
<ul>
<li><code>FILL</code>: click on the marker size, select <code>BY VALUE</code>, set <code>total_damage</code> as the variable and choose a color.</li>
<li>Change the <code>STROKE</code> to 0.</li>
<li>Switch to <code>VALUES</code> to <code>CARTOCSS</code>. Explain that the CartoCSS command line allows more advanced users to layer style in a more precise way.</li>
</ul>
<blockquote>
<p>Switch to the CartoCSS view and check how the quantitative map has been defined. You&rsquo;ll see a <code>ramp()</code> function. This is TurboCarto, our CartoCSS processor that helps creating parametric symbolization based on column values. Learn more about TurboCarto in this <a href="TO DO">awesome blog post</a> by our senior cartographer <a href="TODO">Mamata Akella</a>.</p>
</blockquote>
<p><img alt="2" src="https://cloud.githubusercontent.com/assets/5215798/17328914/76274a4e-58c0-11e6-8058-63c87cc51be5.png" /></p>
<h4 id="3-add-widgets"><a name="user-content-3-add-widgets" href="#3-add-widgets" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. Add widgets</h4>
<h5 id="3-1-back-to-the-main-menu-select-widgets"><a name="user-content-3-1-back-to-the-main-menu-select-widgets" href="#3-1-back-to-the-main-menu-select-widgets" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. 1. Back to the main menu, select <code>WIDGETS</code></h5>
<ul>
<li><code>ADD WIDGET</code>:</li>
<li><em>Railroad Companies Category Widget</em>: select <code>Category</code>, choose <code>railroad</code>, and click on <code>CONTINUE</code>. In order to rename the widget, come back to the list of widgets and double click on the name and rename it as &ldquo;Railroad Companies&rdquo;.<ul>
<li>Take a look on how CARTO Builder sets a connection between vizualization and widgets. This connection is bidirectional, the map changes widgets values and clicking on categories changes the map.</li>
<li>Click on the <code>Auto style</code> droplet button to see how each dot is colored according to its category.</li>
<li>Disable the <code>Auto style</code> to come back to the default visualization.</li>
</ul>
</li>
</ul>
<p><img alt="3-1" src="https://cloud.githubusercontent.com/assets/5215798/17328916/7bb75904-58c0-11e6-9034-a341bfd8f27c.png" /></p>
<ul>
<li><em>Total Damage Formula Widget</em>: select <code>Formula</code>, choose <code>total_damage</code>, and click on <code>CONTINUE</code> and set <code>OPERATION</code> to <code>sum</code> and add <code>$</code> as <code>PREFIX</code>. In order to rename the widget, come back to the list of widgets and double click on the name and rename it as &ldquo;Total damage&rdquo;.<ul>
<li>Again, experimient with the connection between visualization and widgets.</li>
<li>Try to filter by company and see how the total damage widget is updated automatically.</li>
<li>Change the order of the widgets, you can prioritize visually one over another.</li>
</ul>
</li>
</ul>
<p><img alt="3-2" src="https://cloud.githubusercontent.com/assets/5215798/17328921/7fb32b6e-58c0-11e6-8b8a-951060579d0b.png" /></p>
<ul>
<li><em>Date Time Series Widget</em>: select <code>Time Series</code>, choose <code>date</code>, and click on <code>CONTINUE</code> in order to rename the widget.</li>
</ul>
<p><img alt="3-3" src="https://cloud.githubusercontent.com/assets/5215798/17328927/84d65562-58c0-11e6-93cc-734f39349667.png" /></p>
<h4 id="4-add-us-counties-layer-start-the-analysis"><a name="user-content-4-add-us-counties-layer-start-the-analysis" href="#4-add-us-counties-layer-start-the-analysis" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4. Add US counties layer, start the analysis</h4>
<h5 id="4-1-back-to-the-main-menu-select-layers-then-add"><a name="user-content-4-1-back-to-the-main-menu-select-layers-then-add" href="#4-1-back-to-the-main-menu-select-layers-then-add" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4. 1. Back to the main menu, select <code>LAYERS</code>, then <code>ADD</code></h5>
<ul>
<li>Click on <code>DATA LIBRARY</code>, type &ldquo;counties&rdquo; on the <code>SEARCH</code> bar, select the  <strong><code>cb_2013_us_county_500k</code></strong> dataset and finally, click on <code>ADD LAYER</code>.</li>
<li>Rename the new layer to &ldquo;US Counties&rdquo;.</li>
</ul>
<h5 id="4-2-click-on-us-counties-layer-analyses-add-analysis"><a name="user-content-4-2-click-on-us-counties-layer-analyses-add-analysis" href="#4-2-click-on-us-counties-layer-analyses-add-analysis" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4. 2. Click on &ldquo;US Counties&rdquo; layer, <code>ANALYSES</code>, <code>ADD ANALYSIS</code></h5>
<ul>
<li>Select <code>Intersect second layer</code>: this analysis performs a spatial intersection and aggregates the geometry values from the target layer that intersect with the geometry of the source layer..</li>
<li>Select &ldquo;Railroad accidents&rdquo; as <code>TARGET LAYER</code> and <code>SUM(total_damage)</code> as <code>OPERATION</code>. Apply.</li>
<li>When the analysis is done, an explanatory window will pop up. Click on <code>DONE</code>.</li>
</ul>
<blockquote>
<p><strong>Warning</strong>: if you have not run this analysis before, you could encounter a well known bug. This consist on that instead of polygons, you get points. You can get the right geometry changing the style of the layer.</p>
</blockquote>
<ul>
<li>First, using the map take a look on the results of the analysis: only the counties overlapping with data points are showed. Secondly, go to the dataset view to show the new column created with the previous analysis, <code>sum_total_damage</code>.</li>
</ul>
<p><img alt="4-1" src="https://cloud.githubusercontent.com/assets/5215798/17328928/86752772-58c0-11e6-9621-94dcebc33d71.png" /></p>
<ul>
<li>
<p><em>Sum Total Damage Histogram Widget</em>: from the same <code>DATA</code> section, check the <code>Add as a widget</code> box of the <code>sum_total_damage</code> field and <code>EDIT</code>. This will create a new histogram widget. Set the buckets to <code>7</code> and rename it as &ldquo;Sum Total Damage&rdquo;.</p>
</li>
<li>
<p>Use the autostyling and removing the visibility of the &ldquo;Railroad accidents&rdquo; layer. Remove auto style again. Go back to the main menu.</p>
</li>
</ul>
<p><img alt="4-2" src="https://cloud.githubusercontent.com/assets/5215798/17328931/88fc8ba2-58c0-11e6-9d72-252d3547bedd.png" /></p>
<h4 id="5-continue-the-analysis-get-outliers-and-clusters"><a name="user-content-5-continue-the-analysis-get-outliers-and-clusters" href="#5-continue-the-analysis-get-outliers-and-clusters" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>5. Continue the analysis, get outliers and clusters</h4>
<h5 id="5-1-click-on-add-analysis-just-below-us-counties"><a name="user-content-5-1-click-on-add-analysis-just-below-us-counties" href="#5-1-click-on-add-analysis-just-below-us-counties" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>5. 1. Click on <code>ADD ANALYSIS</code> just below &ldquo;US Counties&rdquo;</h5>
<ul>
<li>Select <code>Detect outliers and clusters</code>: this analysis finds areas in your data where clusters of high values or low values exist, as well as areas which are dissimilar from their neighbors.</li>
<li>Select <code>sum_total_damage</code> as <code>TARGET COLUMN</code> and leave the rest of parameters with the default values. Apply.</li>
<li>
<p>Again, when the analysis is done, an explanatory window will pop up. Click on <code>DONE</code>.</p>
</li>
<li>
<p>First, using the map show the viewer the results of the analysis: only the counties considered by the analysis as outliers or clusters are showed. Secondly, go to the dataset view to show the new columns created with the previous analysis, <code>quad</code> is the column more interesting because contains the groups that the analysis has made:</p>
</li>
<li>
<p><code>HH</code> and <code>LL</code>: clusters of high or low values surrounded by similar values</p>
</li>
<li><code>HL</code> and <code>LH</code>: outliers of high or low values surrounded by opposite values</li>
</ul>
<p><img alt="5-1" src="https://cloud.githubusercontent.com/assets/5215798/17328938/8e439bb4-58c0-11e6-8bd6-cc5f879d0e08.png" /></p>
<ul>
<li>
<p>We are going to add a last widget, <em>Sum Total Damage Histogram Widget</em>: click on <code>WIDGETS</code>, <code>ADD</code>, <code>Category</code> and select <code>quads</code>. <code>CONTINUE</code>. Rename it as &ldquo;Groups&rdquo;.</p>
</li>
<li>
<p>Filter by <code>HH</code> and <code>HL</code> counties. Those are counties with high value of total damage surrounded by counties with also high values, and counties with high value of total damage surrounded by counties with low values. Click on <code>Auto style</code> to better distinguish them. Remove the auto style.</p>
</li>
</ul>
<p><img alt="5-2" src="https://cloud.githubusercontent.com/assets/5215798/17328939/9126bb7c-58c0-11e6-83e7-18e615cbbd63.png" /></p>
<h4 id="6-share-and-export-your-results"><a name="user-content-6-share-and-export-your-results" href="#6-share-and-export-your-results" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6. Share and export your results</h4>
<h5 id="6-1-back-to-the-main-menu-click-on-the-three-dots-on-the-us-counties-layer"><a name="user-content-6-1-back-to-the-main-menu-click-on-the-three-dots-on-the-us-counties-layer" href="#6-1-back-to-the-main-menu-click-on-the-three-dots-on-the-us-counties-layer" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6. 1. Back to the main menu, click on the three dots on the &ldquo;US Counties&rdquo; layer</h5>
<ul>
<li>Select <code>Export data</code>, choose <code>CSV</code>.</li>
<li>Open (with Excel or another similar software) the csv file you just download <strong><code>US_Counties.csv</code></strong>. Collapse <code>the_geom</code> column. You should have 39 counties/rows, containing only <code>HH</code> and <code>HL</code> values.</li>
</ul>
<p><img alt="6-1" src="https://cloud.githubusercontent.com/assets/5215798/17328946/975cfdd0-58c0-11e6-9f86-2c00e7b61361.png" /></p>
<h5 id="6-2-back-to-the-main-menu-show-the-publish-dialogs"><a name="user-content-6-2-back-to-the-main-menu-show-the-publish-dialogs" href="#6-2-back-to-the-main-menu-show-the-publish-dialogs" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6. 2. Back to the main menu, show the publish dialogs</h5>
<ul>
<li>Below the map title it should show <code>PRIVATE</code>, <code>ADD PEOPLE</code> and <code>Map not published yet</code>. Let&rsquo;s change that.</li>
<li>First, click on <code>PRIVATE</code>, and again. Select <code>Link</code>.</li>
<li>Secondly, click on <code>SHARE</code> (at the bottom of the main menu). Click on <code>PUBLISH</code>, and then <code>DONE</code>.</li>
<li>Get the link and past it into your browser.</li>
</ul>
<blockquote>
<p>The dashboard should show your &ldquo;Railroad accidents&rdquo; as green dots with sizes depending on the total damage. In addition, all the groups of counties will be displayed. This is because the filters and auto styling you did, it is not applied. Finally, you will have four widgets but in different order.</p>
</blockquote>
<p><img alt="6-2" src="https://cloud.githubusercontent.com/assets/5215798/17328947/9b4b2a5c-58c0-11e6-8e97-de7e5693c0a8.png" /></p>
<ul>
<li>Back to the main menu, click on &ldquo;US Counties&rdquo; layer. Go to the <code>STYLE</code> tab. Style the layer with a <code>FILL</code> <code>BY VALUE</code>. Select <code>quads</code> as variable and choose a couple of colors that can be easily distinguished.</li>
<li>Click again on <code>SHARE</code> and now in <code>UPDATE</code>.</li>
<li>Now if you go back to your browser tab where you have pasted the link nothing has changed. But if you refresh the page, voilá! The colors have modified.</li>
</ul>
<p><img alt="6-3" src="https://cloud.githubusercontent.com/assets/5215798/17328949/9e738aa8-58c0-11e6-88c8-1da87e01e342.png" /></p>
<h2 id="engine"><a name="user-content-engine" href="#engine" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Engine <a name="engine"></a></h2>
<h3 id="spatial-sql"><a name="user-content-spatial-sql" href="#spatial-sql" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Spatial SQL  <a name="postgis"></a></h3>
<p>On this section you&rsquo;ll have the chance to test some of the most common <a href="http://postgis.net/docs/reference.html">PostGIS</a> SQL procedures. To follow this section you only need to open a browser pointing to this url: <a href="http://bl.ocks.org/jsanz/raw/fcb8394e084919a4135188b7c30504ad/"><a href="http://bl.ocks.org/jsanz/raw/fcb8394e084919a4135188b7c30504ad/"><a href="http://bl.ocks.org/jsanz/raw/fcb8394e084919a4135188b7c30504ad/">http://bl.ocks.org/jsanz/raw/fcb8394e084919a4135188b7c30504ad/</a></a></a> and change the Maps API entry point to <code>http://geostat-api.carto.com/api/v1/map</code>.</p>
<p><img alt="" src="/home/jsanz/src/cartodb/training/img/160921-geostat/sql-block.png" /></p>
<p>From that point, you can place any valid query on the SQL panel that plays with the following datasets from <a href="http://www.naturalearthdata.com/">Natural Earth</a></p>
<ul>
<li><code>ne_50m_land</code></li>
<li><code>ne_adm0_europe</code></li>
<li><code>ne_10m_populated_places_simple</code></li>
</ul>
<p>Over different examples we&rsquo;ll see how to make buffers, intersect or calculate lines between different features of those tables. You can paste the SQL presented on the panel, make changes and see how it works saving them using <code>Control+S</code> or <code>Command+S</code> depending on your operating system.</p>
<h4 id="contents_1"><a name="user-content-contents_1" href="#contents_1" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Contents</h4>
<ul>
<li>Transform to a different projection</li>
<li>Get the number of points inside a polygon</li>
<li>Know wether a geometry is <strong>within</strong> the given range from another geometry:</li>
<li>Create a <strong>buffer</strong> from points:</li>
<li>Get the <strong>difference</strong> between two geometries:</li>
<li>Create a <strong>straight line</strong> between two points:</li>
<li>Create <strong>great circles</strong> between two points:</li>
<li>Generating Grids with CDB functions</li>
</ul>
<h4 id="transform-to-a-different-projection"><a name="user-content-transform-to-a-different-projection" href="#transform-to-a-different-projection" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Transform to a different projection</h4>
<pre><code class="sql">SELECT
  cartodb_id,
  ST_Transform(the_geom, 54030) AS the_geom_webmercator
FROM
  ne_50m_land
</code></pre>

<p><em>About <a href="http://cartodb.github.io/training/intermediate/cartocss.html#projections">working with different projections in CARTO</a> and <a href="http://postgis.net/docs/ST_Transform.html"><code>ST_Transform</code></a>.</em></p>
<h4 id="get-the-number-of-points-inside-a-polygon"><a name="user-content-get-the-number-of-points-inside-a-polygon" href="#get-the-number-of-points-inside-a-polygon" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Get the number of points inside a polygon</h4>
<p>Using <code>GROUP BY</code>:</p>
<pre><code class="sql">SELECT
  e.cartodb_id,
  e.admin,
  e.the_geom_webmercator,
  count(*) AS pp_count,
  sum(p.pop_max) as sum_pop
FROM
  ne_adm0_europe e
JOIN
  ne_10m_populated_places_simple p
ON
  ST_Intersects(p.the_geom, e.the_geom)
GROUP BY
  e.cartodb_id
</code></pre>

<p>Using <code>LATERAL</code>:</p>
<pre><code class="sql">SELECT
  a.cartodb_id,
  a.admin AS name,
  a.the_geom_webmercator,
  counts.number_cities AS pp_count,
  counts.sum_pop
FROM
  ne_adm0_europe a
CROSS JOIN LATERAL
  (
    SELECT
      count(*) as number_cities,
      sum(pop_max) as sum_pop
    FROM
      ne_10m_populated_places_simple b
    WHERE
      ST_Intersects(a.the_geom, b.the_geom)
  ) AS counts
</code></pre>

<p><em>About <a href="http://postgis.net/docs/ST_Intersects.html"><code>ST_Intersects</code></a> and <a href="http://blog.heapanalytics.com/postgresqls-powerful-new-join-type-lateral">Lateral JOIN</a></em></p>
<hr />
<p><strong>Note:</strong> Add this piece of CartoCSS at the end so you have a nice coropleth map:</p>
<pre><code class="css">#layer['mapnik::geometry_type'=3] {
  line-width: 0;
  polygon-fill: ramp([pp_count], (&quot;#edd9a3&quot;,&quot;#f99178&quot;,&quot;#ea4f88&quot;,&quot;#a431a0&quot;,&quot;#4b2991&quot;), quantiles(5));
}
</code></pre>

<p>This is using the new <a href="https://carto.com/blog/styling-with-turbo-carto/">turbo-carto</a> feature on CARTO to allow creating ramps from data without having to put the styles directly</p>
<hr />
<hr />
<p><strong>Note:</strong> You know about the <code>EXPLAIN ANALYZE</code> function? use it to take a look on how both queries are pretty similar in terms of performance.</p>
<hr />
<h4 id="know-wether-a-geometry-is-within-the-given-range-from-another-geometry"><a name="user-content-know-wether-a-geometry-is-within-the-given-range-from-another-geometry" href="#know-wether-a-geometry-is-within-the-given-range-from-another-geometry" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Know wether a geometry is <strong>within</strong> the given range from another geometry:</h4>
<pre><code class="sql">SELECT
  a.*
FROM
  ne_10m_populated_places_simple a,
  ne_10m_populated_places_simple b
WHERE
    a.cartodb_id != b.cartodb_id
  AND ST_DWithin(
      a.the_geom_webmercator,
      b.the_geom_webmercator,
      150000
    )
  AND a.adm0name = 'Spain'
  AND b.adm0name = 'Spain'
</code></pre>

<p>In this case, we are using <code>the_geom_webmercator</code> to avoid casting to <code>geography</code> type. Calculations made with <code>geometry</code> type takes the CRS units.</p>
<p>Keep in mind that CRS <strong>units in webmercator are not meters</strong>, and they depend directly on the latitude.</p>
<p><em>About <a href="http://postgis.net/docs/ST_DWithin.html"><code>ST_DWithin</code></a>.</em></p>
<h4 id="create-a-buffer-from-points"><a name="user-content-create-a-buffer-from-points" href="#create-a-buffer-from-points" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Create a <strong>buffer</strong> from points:</h4>
<pre><code class="sql">SELECT
  cartodb_id,
  name,
  ST_Transform(
    ST_Buffer(the_geom::geography, 250000)::geometry
    ,3857
  ) AS the_geom_webmercator
FROM
  ne_10m_populated_places_simple
WHERE
  name ilike 'trondheim'
</code></pre>

<p>Compare the result with</p>
<pre><code class="sql">SELECT
  cartodb_id,
  name,
  ST_Transform(
    ST_Buffer(the_geom, 2)
    ,3857
  ) AS the_geom_webmercator
FROM
  ne_10m_populated_places_simple
WHERE
  name ilike 'trondheim'
</code></pre>

<p>Why this is not a circle?</p>
<p><em>About <a href="http://postgis.net/docs/ST_Buffer.html"><code>ST_Buffer</code></a>.</em></p>
<h4 id="get-the-difference-between-two-geometries"><a name="user-content-get-the-difference-between-two-geometries" href="#get-the-difference-between-two-geometries" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Get the <strong>difference</strong> between two geometries:</h4>
<pre><code class="sql">SELECT
  a.cartodb_id,
    ST_Difference(
        a.the_geom_webmercator,
        b.the_geom_webmercator
  ) AS the_geom_webmercator
FROM
  ne_50m_land a,
  ne_adm0_europe b
WHERE
  b.adm0_a3 like 'ESP'
</code></pre>

<p><em>About <a href="http://postgis.net/docs/ST_Difference.html"><code>ST_Difference</code></a>.</em></p>
<h4 id="create-a-straight-line-between-two-points"><a name="user-content-create-a-straight-line-between-two-points" href="#create-a-straight-line-between-two-points" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Create a <strong>straight line</strong> between two points:</h4>
<pre><code class="sql">SELECT
  ST_MakeLine(
    a.the_geom_webmercator,
    b.the_geom_webmercator
  ) as the_geom_webmercator
FROM (
    SELECT * FROM ne_10m_populated_places_simple
    WHERE name ILIKE 'madrid'
  ) as a,
  (
    SELECT * FROM ne_10m_populated_places_simple
    WHERE name ILIKE 'barcelona'AND adm0name ILIKE 'spain'
  ) as b
</code></pre>

<p><em>About <a href="http://postgis.net/docs/ST_MakeLine.html"><code>ST_MakeLine</code></a>.</em></p>
<h4 id="create-great-circles-between-two-points"><a name="user-content-create-great-circles-between-two-points" href="#create-great-circles-between-two-points" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Create <strong>great circles</strong> between two points:</h4>
<pre><code class="sql">SELECT
  ST_Transform(
    ST_Segmentize(
      ST_Makeline(
        a.the_geom,
        b.the_geom
      )::geography,
      100000
    )::geometry,
  3857
  ) as the_geom_webmercator
FROM
  (SELECT * FROM ne_10m_populated_places_simple
  WHERE name ILIKE 'madrid') as a,
  (SELECT * FROM ne_10m_populated_places_simple
  WHERE name ILIKE 'new york') as b
</code></pre>

<p><em>About <a href="http://blog.cartodb.com/jets-and-datelines/">Great Circles</a>.</em></p>
<h4 id="generating-grids-with-cdb-functions"><a name="user-content-generating-grids-with-cdb-functions" href="#generating-grids-with-cdb-functions" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Generating Grids with CDB functions</h4>
<h5 id="rectangular-grid"><a name="user-content-rectangular-grid" href="#rectangular-grid" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Rectangular grid</h5>
<pre><code class="sql">SELECT
  row_number() over () as cartodb_id,
  CDB_RectangleGrid(
    ST_Buffer(the_geom_webmercator,125000),
  250000,
  250000
  ) AS the_geom_webmercator
FROM
  ne_adm0_europe
WHERE
  adm0_a3 IN ('ITA','GBR')
</code></pre>

<p><em>About <a href="http://docs.cartodb.com/tips-and-tricks/cartodb-functions/#a-rectangle-grid">CDB_RectangleGrid</a></em></p>
<h5 id="adaptative-hexagonal-grid"><a name="user-content-adaptative-hexagonal-grid" href="#adaptative-hexagonal-grid" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Adaptative Hexagonal grid</h5>
<pre><code class="sql">WITH grid AS (
  SELECT
    row_number() over () as cartodb_id,
    CDB_HexagonGrid(
      ST_Buffer(the_geom_webmercator, 100000),
      100000
    ) AS the_geom_webmercator
  FROM
    ne_adm0_europe
  WHERE
    adm0_a3 IN ('ESP','ITA')
)
SELECT
  grid.the_geom_webmercator,
  grid.cartodb_id
FROM
  grid, ne_adm0_europe a
WHERE
  a.adm0_a3 IN ('ESP','ITA') AND
  ST_intersects(
    grid.the_geom_webmercator,
    a.the_geom_webmercator
  )
</code></pre>

<p><em>About <a href="http://docs.cartodb.com/tips-and-tricks/cartodb-functions/#a-hexagon-grid">CDB_HexagonGrid</a></em></p>
<h3 id="exploring-carto-engine-apis"><a name="user-content-exploring-carto-engine-apis" href="#exploring-carto-engine-apis" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Exploring CARTO Engine APIs <a name="apis"></a></h3>
<p>This section covers the basic usage of main <a href="carto.com/docs">CARTO Engine APIs</a>. Using a software called <a href="http://getpostman.com">Postman</a> you&rsquo;ll be able to experiment with the different APIs and see how to interact directly with the platform. This is specially useful if you are going to do it from a different environment than JavaScript, as it will be covered on the last part of this workshop.</p>
<p>Setting up your environment:</p>
<ul>
<li>Open your Postman installation (normally a Google Chrome extension)</li>
<li>Install a new collection from <a href="https://raw.githubusercontent.com/ernesmb/CARTO-Engine-collection/master/CARTO_Training_Collection.postman_collection.json">this link</a></li>
<li>Download the environment provided by the instructor (see the shared notes doc)</li>
</ul>
<p><img alt="" src="/home/jsanz/src/cartodb/training/img/160921-geostat/postman.png" /></p>
<h4 id="sql-api"><a href="https://carto.com/docs/carto-engine/sql-api/">SQL API</a></h4>
<p>This is the API to interact directly with your database. You can perform not just any SELECT query but also create tables, add triggers and functions.</p>
<h4 id="maps-api"><a href="https://carto.com/docs/carto-engine/maps-api/">Maps API</a></h4>
<p>The Maps API is the rendering engine for CARTO. This API needs in essence a query and a cartographic symbology definition to render tiles to be used on your web mapping applications. When datasets are public (as in Free accounts) you can specify queries and CartoCSS directly on your call. When private datasets are involved, then you need to define a template and give it a name to be instantiated by the final users.</p>
<h4 id="import-api"><a href="https://carto.com/docs/carto-engine/import-api/">Import API</a></h4>
<p>To upload bulk data to CARTO you need to use the Import API. This provides mechanisms to upload files or define the url from where CARTO will fetch your data and create tables on your account.</p>
<h2 id="webmapping-apps-with-cartojs"><a name="user-content-webmapping-apps-with-cartojs" href="#webmapping-apps-with-cartojs" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Webmapping apps with CARTO.js <a name="cartojs"></a></h2>
<h3 id="cartojs"><a name="user-content-cartojs" href="#cartojs" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>CARTO.js</h3>
<p><a href="https://carto.com/docs/carto-engine/carto-js/">CARTO.js</a> is the JavaScript library that allows to create web mapping apps using CARTO services quickly and efficiently. It&rsquo;s built upon the following components:</p>
<ul>
<li><a href="http://jquery.com">jQuery</a></li>
<li><a href="http://underscorejs.org">Underscore.js</a></li>
<li><a href="http://backbonejs.org/">Backbone.js</a></li>
<li>It can use either <a href="https://developers.google.com/maps/">Google Maps API</a> or <a href="http://leafletjs.com/">Leaflet</a></li>
</ul>
<p>Know more about CARTO.js on the <a href="https://carto.com/docs/carto-engine/carto-js/">official documentation</a> and this <a href="https://carto.com/academy/courses/cartojs-ground-up/">academy tutorial</a>.</p>
<p>Next sections and an excerpt of the documentation with the most useful methods and a the end you&rsquo;ll find live examples of them that you can modify and hack in real time.</p>
<h3 id="create-visualizations-and-layers"><a name="user-content-create-visualizations-and-layers" href="#create-visualizations-and-layers" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Create Visualizations and Layers</h3>
<h4 id="createvis"><code>createVis()</code></h4>
<p>The most basic way to display your map from CARTO.js involves a call to:</p>
<pre><code class="javascript">cartodb.createVis(div_id, viz_json_url)
</code></pre>

<p>Couched between the <code>&lt;script&gt; ... &lt;/script&gt;</code> tags, <code>createVis</code> puts a map and CartoDB data layers into the DOM element you specify. In the snippet below we assume that <code>&lt;div id='map'&gt;&lt;/div&gt;</code> placed earlier in an HTML file.</p>
<pre><code class="javascript">window.onload = function() {
  var vizjson = 'link from share panel';
  cartodb.createVis('map', vizjson);
}
</code></pre>

<p>And that’s it! All you need is that snippet of code, a script block that sources CARTO.js, and inclusion of the CARTO.js CSS file. It’s really one of the easiest ways to create a custom map on your webpage. <code>createVis</code> also accepts options that you specifiy outside of the CartoDB Editor. They take the form of a <a href="http://www.w3schools.com/js/js_objects.asp">JS object</a>, and can be passed as a third optional argument.</p>
<pre><code class="javascript">var options = {
  center: [40.4000, -3.6833], // Madrid
  zoom: 7,
  scrollwheel: true
};

cartodb.createVis('map', vizjson, options);
</code></pre>

<h4 id="createlayer"><code>createLayer()</code></h4>
<p>If you want to exercise more control over the layers and base map, <code>createLayer</code> may be the best option for you. You specifiy the base map yourself and load the layer from one or multiple viz.json files. Unlike <code>createVis</code>, <code>createLayer</code> needs a map object, such as one created by Google Maps or Leaflet. This difference allows for more control of the basemap for the JavaScript/HTML you’re writing.</p>
<p>A basic <a href="http://leafletjs.com/reference.html#map-class">Leaflet map</a> without your data can be created as follows:</p>
<pre><code class="javascript">window.onload = function() {
  // Choose center and zoom level
  var options = {
    center: [41.8369, -87.6847], // Chicago
    zoom: 7
  }

  // Instantiate map on specified DOM element
  var map = new L.Map(dom_id, options);

  // Add a basemap to the map object just created
  L.tileLayer('http://tile.stamen.com/toner/{z}/{x}/{y}.png', {
    attribution: 'Stamen'
  }).addTo(map);
}
</code></pre>

<p>The map we just created doesn’t have any CartoDB data layers yet. If you’re just adding a single layer, you can put your data on top of the basemap from above. If you want to add more, you just repeat the process. We’ll be doing much more with this later. This is the basic snippet to put your data on top of the map you just created. Drop this in below the <code>L.tileLayer</code> section.</p>
<pre><code class="javascript">var vizjson = 'link from share panel';
cartodb.createLayer(map, vizjson).addTo(map);
</code></pre>

<h3 id="ui-functions"><a name="user-content-ui-functions" href="#ui-functions" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>UI Functions</h3>
<h4 id="tooltips"><a name="user-content-tooltips" href="#tooltips" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Tooltips</h4>
<p>A tooltip is an infowindow that appears when you hover your mouse over a map feature with vis.addOverlay(options). A tooltip appears where the mouse cursor is located on the map.</p>
<p>To add a tooltip to a map you need to do two steps:</p>
<p>First, define tooltip variable:</p>
<p><pre><code class="javascript">  var tooltip = layer.leafletMap.viz.addOverlay({
            type: 'tooltip',
            layer: layer,
            template: '&lt;div class=&quot;cartodb-tooltip-content-wrapper&quot;&gt;&lt;p&gt;{% raw %}{{name}}{% endraw %}&lt;/p&gt;&lt;/div&gt;',
            width: 200,
            position: 'bottom|right',
            fields: [{ name: 'name' }]
  });
</code></pre><br />
Second, add tooltip to the map:</p>
<pre><code class="javascript">     $('body').append(tooltip.render().el);
</code></pre>

<h4 id="infowindows"><a name="user-content-infowindows" href="#infowindows" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Infowindows</h4>
<p>Infowindows provide additional interactivity for your published map, controlled by layer events. It enables interaction and overrides the layer interactivity. A pop-up information window appears when a viewer clicks on a map feature.</p>
<p>In order to add the CARTO.js infowindow you need to add this line within your code:</p>
<pre><code class="javascript">cdb.vis.Vis.addInfowindow(map, layer, ['fields']);
</code></pre>

<p>However, you can create custom infowindows with different tools (<code>Moustache.js</code>, HTML or <code>underscore.js</code>). Whatever choice you make, you would need to create a template first and then add the infowindow with the template. Here we will see how to do it using <code>Moustache.js</code>.</p>
<p><a href="http://mustache.github.io/">Mustache.js</a> is a <code>logic-less</code> logic-template. That means that only tags you create templates that are replaced with a value or series of values, it works by expanding tags in a template using values provided in a hash or object.</p>
<p>Example: Custom infowindow template to display <code>cartodb_id</code>:</p>
<pre><code class="html">  &lt;script type=&quot;infowindow/html&quot; id=&quot;infowindow_template&quot;&gt;
    &lt;div class=&quot;cartodb-popup v2&quot;&gt;
  &lt;a href=&quot;#close&quot; class=&quot;cartodb-popup-close-button close&quot;&gt;x&lt;/a&gt;
  &lt;div class=&quot;cartodb-popup-content-wrapper&quot;&gt;
    &lt;div class=&quot;cartodb-popup-content&quot;&gt;
      &lt;h4&gt;ID&lt;/h4&gt;
      &lt;p&gt;{% raw %}{{cartodb_id}}{% endraw %}&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=&quot;cartodb-popup-tip-container&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/script&gt;
</code></pre>

<p>Then you can apply the custom infowindow template to the map with:</p>
<pre><code class="javascript">cdb.vis.Vis.addInfowindow(
          map, layer, [columnName],
          {
             infowindowTemplate: $('#infowindow_template').html()
          });
</code></pre>

<h4 id="legends"><a name="user-content-legends" href="#legends" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Legends</h4>
<p>In order to add legends with CARTO.js you would need to define the elements and colors of the legend with HTML, then you could use the legend classes of CARTO.js to create the legends.</p>
<p>There are two kind of legend classes:</p>
<p>First, <code>cartodb-legend choropleth</code>, applied in Choropleth maps:</p>
<pre><code class="html">&lt;div class='cartodb-legend choropleth'&gt;
    &lt;div class=&quot;legend-title&quot;&gt;Population&lt;/div&gt;
      &lt;ul&gt;
        &lt;li class=&quot;min&quot;&gt;
          1256
        &lt;/li&gt;
        &lt;li class=&quot;max&quot;&gt;
          8300
        &lt;/li&gt;
        &lt;li class=&quot;graph count_441&quot;&gt;
        &lt;div class=&quot;colors&quot;&gt;
        &lt;div class=&quot;quartile&quot; style=&quot;background-color:#FFFFB2&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;quartile&quot; style=&quot;background-color:#FED976&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;quartile&quot; style=&quot;background-color:#FEB24C&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;quartile&quot; style=&quot;background-color:#FD8D3C&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;quartile&quot; style=&quot;background-color:#FC4E2A&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;quartile&quot; style=&quot;background-color:#E31A1C&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;quartile&quot; style=&quot;background-color:#B10026&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
  &lt;/div&gt;
</code></pre>

<p>Second, <code>cartodb-legend category</code>, applied in simple or category maps:</p>
<pre><code class="html">    &lt;div class='cartodb-legend category'&gt;
      &lt;div class=&quot;legend-title&quot; style=&quot;color:#284a59&quot;&gt;Countries&lt;/div&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;div class=&quot;bullet&quot; style=&quot;background-color:#fbb4ae&quot;&gt;&lt;/div&gt;Spain&lt;/li&gt;
          &lt;li&gt;&lt;div class=&quot;bullet&quot; style=&quot;background-color:#ccebc5&quot;&gt;&lt;/div&gt;Portugal&lt;/li&gt;
          &lt;li&gt;&lt;div class=&quot;bullet&quot; style=&quot;background-color:#b3cde3&quot;&gt;&lt;/div&gt;France&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
</code></pre>

<h3 id="examples"><a name="user-content-examples" href="#examples" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Examples</h3>
<p>Loading maps:</p>
<ul>
<li><a href="http://plnkr.co/edit/plhwv3IQwFxLHBGWodQp?p=preview">Load a visualisation with <code>createVis()</code></a></li>
<li><a href="http://plnkr.co/edit/aG7ZSN24WBE6d8ZJQTqY?p=preview">Load SQL+CartoCSS anonymous map with <code>createLayer</code></a></li>
<li><a href="http://plnkr.co/edit/HitBoz?p=preview">Load named map with <code>createLayer</code></a></li>
</ul>
<p>Changing the visualization:</p>
<ul>
<li><a href="http://plnkr.co/edit/SzMbyj?p=preview">Change SQL and CartoCSS dynamically</a></li>
<li><a href="http://plnkr.co/edit/c7gFkI?p=preview">Change named maps parameters</a></li>
</ul>
<p>Layer interactivity:</p>
<ul>
<li><a href="http://plnkr.co/edit/88Qc99jdgP4X43FSTRdH?p=preview">Events. Actions on feature click</a></li>
<li><a href="http://plnkr.co/edit/9FE6BHILGudsIrDmCzdd?p=preview">Custom Infowindows</a></li>
<li><a href="http://plnkr.co/edit/uD0Fdw?p=preview">Custom Tooltip:</a></li>
</ul>
<p>Advanced examples:</p>
<ul>
<li><a href="http://bl.ocks.org/javisantana/8313604">Highlight polygons on hover</a></li>
<li><a href="http://bl.ocks.org/ernesmb/4939b3751d3be0cdd64b">Playing with Torque time</a></li>
<li><a href="http://bl.ocks.org/ernesmb/348b9eed9ee4c7038fd7">Aggregating content from clustered features with SQL</a></li>
<li><a href="http://bl.ocks.org/jsanz/6a83dbae9d6e984ca938">Creating a simple layer selector</a></li>
</ul>
<hr /></article></body></html>